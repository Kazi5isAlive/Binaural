<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kazi's Beats </title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            margin-top: 0;
        }
        button {
            cursor: pointer;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        .play-button {
            display: block;
            width: 100%;
            margin: 20px 0;
            background-color: #4CAF50;
            color: white;
            font-size: 18px;
            padding: 15px;
        }
        .play-button.playing {
            background-color: #f44336;
        }
        .preset-buttons {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 5px;
        }
        .preset-button {
            flex: 1;
            min-width: 60px;
            background-color: #e0e0e0;
        }
        .preset-button.active {
            background-color: #2196F3;
            color: white;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="range"] {
            width: 100%;
        }
        .info {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            font-size: 14px;
        }
        .info p {
            margin-top: 0;
        }
        .info ul {
            margin-bottom: 0;
            padding-left: 20px;
        }
        #error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Binaural Beat Generator</h1>
        
        <div id="error-message"></div>
        
        <div class="preset-buttons">
            <button class="preset-button" data-type="delta">Delta</button>
            <button class="preset-button active" data-type="theta">Theta</button>
            <button class="preset-button" data-type="alpha">Alpha</button>
            <button class="preset-button" data-type="beta">Beta</button>
            <button class="preset-button" data-type="gamma">Gamma</button>
        </div>
        
        <button id="playButton" class="play-button">Start</button>
        
        <div class="controls">
            <div class="control-group">
                <label for="baseFreq">Base Frequency: <span id="baseFreqValue">300</span> Hz</label>
                <input type="range" id="baseFreq" min="200" max="600" value="300">
            </div>
            
            <div class="control-group">
                <label for="beatFreq">Binaural Beat Frequency: <span id="beatFreqValue">4</span> Hz</label>
                <input type="range" id="beatFreq" min="1" max="40" step="0.5" value="4">
            </div>
            
            <div class="control-group">
                <label for="noiseVol">Background Noise: <span id="noiseVolValue">15</span>%</label>
                <input type="range" id="noiseVol" min="0" max="100" value="15">
            </div>
            
            <div class="control-group">
                <label for="mainVol">Main Volume: <span id="mainVolValue">50</span>%</label>
                <input type="range" id="mainVol" min="0" max="100" value="50">
            </div>
        </div>
        
        <div class="info">
            <p><strong>Current settings:</strong></p>
            <ul>
                <li>Left ear: <span id="leftFreq">300</span> Hz</li>
                <li>Right ear: <span id="rightFreq">304</span> Hz</li>
                <li>Resulting binaural beat: <span id="resultBeat">4</span> Hz (<span id="brainwaveType">theta</span>)</li>
                <li>Background noise: 8,000-11,000 Hz band</li>
            </ul>
            <p><strong>Note:</strong> For best results, use stereo headphones.</p>
        </div>
    </div>

    <script>
        // Debugging console
        console.log("Script loading...");
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded");
            
            // DOM elements
            const errorDisplay = document.getElementById('error-message');
            const playButton = document.getElementById('playButton');
            const baseFreqSlider = document.getElementById('baseFreq');
            const beatFreqSlider = document.getElementById('beatFreq');
            const noiseVolSlider = document.getElementById('noiseVol');
            const mainVolSlider = document.getElementById('mainVol');
            const presetButtons = document.querySelectorAll('.preset-button');
            
            // Display elements
            const baseFreqValue = document.getElementById('baseFreqValue');
            const beatFreqValue = document.getElementById('beatFreqValue');
            const noiseVolValue = document.getElementById('noiseVolValue');
            const mainVolValue = document.getElementById('mainVolValue');
            const leftFreqDisplay = document.getElementById('leftFreq');
            const rightFreqDisplay = document.getElementById('rightFreq');
            const resultBeatDisplay = document.getElementById('resultBeat');
            const brainwaveTypeDisplay = document.getElementById('brainwaveType');
            
            // Audio context and nodes
            let audioContext = null;
            let leftOscillator = null;
            let rightOscillator = null;
            let noiseNode = null;
            let noiseFilter = null;
            let noiseGain = null;
            let mainGain = null;
            let isPlaying = false;
            
            // Current values
            let baseFreq = 300;
            let beatFreq = 4;
            let noiseVol = 0.15;
            let mainVol = 0.5;
            let brainwaveType = 'theta';
            
            function showError(message) {
                errorDisplay.textContent = message;
                errorDisplay.style.display = 'block';
                console.error(message);
            }
            
            function hideError() {
                errorDisplay.style.display = 'none';
            }
            
            // Helper to create white noise
            function createNoiseNode() {
                try {
                    const bufferSize = 2 * audioContext.sampleRate;
                    const noiseBuffer = audioContext.createBuffer(
                        2, 
                        bufferSize, 
                        audioContext.sampleRate
                    );
                    
                    // Fill buffer with white noise
                    for (let channel = 0; channel < noiseBuffer.numberOfChannels; channel++) {
                        const output = noiseBuffer.getChannelData(channel);
                        for (let i = 0; i < bufferSize; i++) {
                            output[i] = Math.random() * 2 - 1;
                        }
                    }
                    
                    // Create noise source from buffer
                    const noise = audioContext.createBufferSource();
                    noise.buffer = noiseBuffer;
                    noise.loop = true;
                    
                    return noise;
                } catch (error) {
                    showError("Error creating noise: " + error.message);
                    return null;
                }
            }
            
            // Set brainwave presets
            function setBrainwavePreset(type) {
                brainwaveType = type;
                brainwaveTypeDisplay.textContent = type;
                
                // Clear active class from all buttons
                presetButtons.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to selected button
                document.querySelector(`.preset-button[data-type="${type}"]`).classList.add('active');
                
                switch(type) {
                    case 'delta':
                        setBaseFreq(200);
                        setBeatFreq(2);
                        break;
                    case 'theta':
                        setBaseFreq(300);
                        setBeatFreq(4);
                        break;
                    case 'alpha':
                        setBaseFreq(400);
                        setBeatFreq(8);
                        break;
                    case 'beta':
                        setBaseFreq(500);
                        setBeatFreq(16);
                        break;
                    case 'gamma':
                        setBaseFreq(600);
                        setBeatFreq(30);
                        break;
                }
            }
            
            // Update base frequency
            function setBaseFreq(freq) {
                baseFreq = freq;
                baseFreqSlider.value = freq;
                baseFreqValue.textContent = freq;
                updateFrequencyDisplays();
                
                if (isPlaying && leftOscillator) {
                    try {
                        leftOscillator.frequency.value = baseFreq;
                        rightOscillator.frequency.value = baseFreq + beatFreq;
                    } catch (error) {
                        showError("Error updating frequencies: " + error.message);
                    }
                }
            }
            
            // Update beat frequency
            function setBeatFreq(freq) {
                beatFreq = freq;
                beatFreqSlider.value = freq;
                beatFreqValue.textContent = freq;
                updateFrequencyDisplays();
                
                if (isPlaying && rightOscillator) {
                    try {
                        rightOscillator.frequency.value = baseFreq + beatFreq;
                    } catch (error) {
                        showError("Error updating beat frequency: " + error.message);
                    }
                }
            }
            
            // Update frequency displays
            function updateFrequencyDisplays() {
                leftFreqDisplay.textContent = baseFreq;
                rightFreqDisplay.textContent = baseFreq + beatFreq;
                resultBeatDisplay.textContent = beatFreq;
            }
            
            // Start sound
            function startSound() {
                hideError();
                
                try {
                    // Create new audio context if needed
                    if (!audioContext) {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        console.log("AudioContext created:", audioContext);
                    }
                    
                    // Resume context if suspended
                    if (audioContext.state === 'suspended') {
                        audioContext.resume();
                    }
                    
                    console.log("AudioContext state:", audioContext.state);
                    
                    // Main volume control
                    mainGain = audioContext.createGain();
                    mainGain.gain.value = mainVol;
                    mainGain.connect(audioContext.destination);
                    
                    // Create oscillators for binaural beat
                    leftOscillator = audioContext.createOscillator();
                    rightOscillator = audioContext.createOscillator();
                    
                    // Set frequencies
                    leftOscillator.frequency.value = baseFreq;
                    rightOscillator.frequency.value = baseFreq + beatFreq;
                    
                    // Create stereo channel merger
                    const merger = audioContext.createChannelMerger(2);
                    
                    // Create gains for each ear
                    const leftGain = audioContext.createGain();
                    const rightGain = audioContext.createGain();
                    
                    // Connect left oscillator
                    leftOscillator.connect(leftGain);
                    leftGain.connect(merger, 0, 0);
                    
                    // Connect right oscillator
                    rightOscillator.connect(rightGain);
                    rightGain.connect(merger, 0, 1);
                    
                    // Connect merger to main output
                    merger.connect(mainGain);
                    
                    // Create and setup noise
                    noiseNode = createNoiseNode();
                    if (noiseNode) {
                        noiseFilter = audioContext.createBiquadFilter();
                        noiseGain = audioContext.createGain();
                        
                        // Configure bandpass filter for high-frequency noise
                        noiseFilter.type = 'bandpass';
                        noiseFilter.frequency.value = 9500; // Center of 8000-11000 Hz range
                        noiseFilter.Q.value = 0.5; // Width of the band
                        
                        // Set noise volume
                        noiseGain.gain.value = noiseVol;
                        
                        // Connect noise
                        noiseNode.connect(noiseFilter);
                        noiseFilter.connect(noiseGain);
                        noiseGain.connect(mainGain);
                    }
                    
                    // Start oscillators and noise
                    leftOscillator.start();
                    rightOscillator.start();
                    if (noiseNode) noiseNode.start();
                    
                    isPlaying = true;
                    playButton.textContent = 'Stop';
                    playButton.classList.add('playing');
                    
                    console.log("Audio started successfully");
                } catch (error) {
                    showError("Failed to start audio: " + error.message);
                    stopSound();
                }
            }
            
            // Stop sound
            function stopSound() {
                try {
                    if (leftOscillator) {
                        leftOscillator.stop();
                        leftOscillator = null;
                    }
                    
                    if (rightOscillator) {
                        rightOscillator.stop();
                        rightOscillator = null;
                    }
                    
                    if (noiseNode) {
                        noiseNode.stop();
                        noiseNode = null;
                    }
                } catch (error) {
                    console.error("Error stopping sound:", error);
                } finally {
                    isPlaying = false;
                    playButton.textContent = 'Start';
                    playButton.classList.remove('playing');
                }
            }
            
            // Event listeners
            playButton.addEventListener('click', function() {
                console.log("Play button clicked");
                
                if (isPlaying) {
                    stopSound();
                } else {
                    startSound();
                }
            });
            
            baseFreqSlider.addEventListener('input', function() {
                setBaseFreq(parseInt(this.value));
            });
            
            beatFreqSlider.addEventListener('input', function() {
                setBeatFreq(parseFloat(this.value));
            });
            
            noiseVolSlider.addEventListener('input', function() {
                const value = parseInt(this.value) / 100;
                noiseVol = value;
                noiseVolValue.textContent = this.value;
                
                if (noiseGain) {
                    try {
                        noiseGain.gain.value = value;
                    } catch (error) {
                        console.error("Error updating noise volume:", error);
                    }
                }
            });
            
            mainVolSlider.addEventListener('input', function() {
                const value = parseInt(this.value) / 100;
                mainVol = value;
                mainVolValue.textContent = this.value;
                
                if (mainGain) {
                    try {
                        mainGain.gain.value = value;
                    } catch (error) {
                        console.error("Error updating main volume:", error);
                    }
                }
            });
            
            presetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    setBrainwavePreset(this.dataset.type);
                });
            });
            
            // Initialize displays
            updateFrequencyDisplays();
            
            console.log("Setup complete - generator ready");
        });
    </script>
</body>
</html>
